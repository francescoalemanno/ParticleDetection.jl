using ParticleDetection
using Test
using Serialization

@testset "Detect Particles" begin
    ima=deserialize(joinpath(@__DIR__, "particles.bin"))
    @time P=detect_particles(ima,6,10,0.2f0)
    @test find_best_radius(ima,P,10) == 12
    @test P==[(1081, 32), (1112, 92), (1145, 120), (1101, 149), (818, 308), (2205, 322),
             (786, 412), (839, 444), (864, 449), (774, 464), (830, 487), (774, 503),
              (871, 510), (801, 523), (816, 537), (835, 541), (805, 549), (863, 555),
              (848, 558), (895, 570), (916, 574), (850, 576), (863, 609), (997, 674),
              (973, 682), (921, 685), (986, 686), (931, 698), (996, 710), (1403, 714),
              (1417, 723), (1160, 740), (1283, 762), (1288, 778), (909, 784), (932, 802),
              (916, 805), (895, 809), (944, 847), (963, 854), (344, 866), (345, 873),
              (917, 873), (930, 951), (701, 971), (876, 1032), (1524, 1099), (1765, 1226),
              (1778, 1238), (1827, 1278), (944, 1280), (933, 1292), (961, 1294), (1285, 1318),
              (1688, 1329), (1285, 1333), (1748, 1333), (1219, 1341), (1285, 1347), (108, 1423),
              (53, 1464), (1276, 1552), (623, 1578), (1194, 1580), (1177, 1583), (1183, 1609),
              (1235, 1610), (1264, 1650), (2193, 1655), (1924, 1674), (1312, 1684), (1914, 1686),
              (2287, 1690), (1966, 1710), (2225, 1710), (1147, 1715), (2253, 1718), (1113, 1719),
              (1327, 1722), (1396, 1738), (1773, 1749), (2154, 1762), (1201, 1770), (2054, 1775),
              (1892, 1779), (1957, 1782), (2023, 1783), (1126, 1794), (1112, 1802), (2086, 1807),
              (1090, 1833), (1573, 1846), (1759, 1849), (2086, 1850), (1127, 1851), (1457, 1859),
              (1167, 1864), (1510, 1885), (887, 1892), (557, 1914), (1214, 1918), (2066, 1939),
              (1848, 1943), (1914, 1953), (1899, 1955), (905, 1957), (1851, 1957), (1866, 1957),
              (2269, 1958), (998, 1965), (1005, 2000), (1373, 2017), (1029, 2043), (2225, 2059),
              (887, 2075), (1632, 2146), (1249, 2147), (1734, 2152), (879, 2153), (836, 2169),
              (892, 2173), (95, 2302), (162, 2327), (431, 2346), (45, 2364), (161, 2364), (268, 2364)]
end
#
# ima=deserialize(joinpath(@__DIR__, "particles.bin"))
# @time P=detect_particles(ima,6,10,0.2f0)
# b_rad=find_best_radius(ima,P,10)
# @time P2=detect_particles(ima,6,b_rad,0.2f0)
#
#
# using PyPlot
# pygui(true)
#
# imshow(ima)
# scatter(getindex.(P2,2).-1,getindex.(P2,1).-1,color="red")
# scatter(getindex.(P,2).-1,getindex.(P,1).-1,color="blue",alpha=0.5)
#
#
